-- SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- GUI CREATION
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NexoraPlotControl"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 240, 0, 170)
Frame.Position = UDim2.new(0.5, -120, 0.5, -85)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.Parent = ScreenGui
Frame.Active = true
Frame.Draggable = true
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 12)

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 25)
Title.Position = UDim2.new(0, 0, 0, 5)
Title.BackgroundTransparency = 1
Title.Text = "PLOT CONTROL"
Title.TextColor3 = Color3.fromRGB(230, 230, 230)
Title.TextScaled = true
Title.Font = Enum.Font.GothamBold
Title.Parent = Frame

-- Discord
local Discord = Instance.new("TextLabel")
Discord.Size = UDim2.new(1, 0, 0, 20)
Discord.Position = UDim2.new(0, 0, 0, 30)
Discord.BackgroundTransparency = 1
Discord.Text = "Discord.gg/PhQF4wAg"
Discord.TextColor3 = Color3.fromRGB(160, 160, 160)
Discord.TextScaled = true
Discord.Font = Enum.Font.GothamBold
Discord.Parent = Frame

-- Bouton CALNA
local Button = Instance.new("TextButton")
Button.Size = UDim2.new(0.9, 0, 0, 50)
Button.Position = UDim2.new(0.05, 0, 0.40, 0)
Button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Button.TextColor3 = Color3.fromRGB(230, 230, 230)
Button.TextScaled = true
Button.Font = Enum.Font.Gotham
Button.Text = "ðŸ”’ CALNA ALLOW FRIENDS : OFF"
Button.Parent = Frame
Instance.new("UICorner", Button).CornerRadius = UDim.new(0, 10)

-- Keybind label
local KeybindLabel = Instance.new("TextLabel")
KeybindLabel.Size = UDim2.new(0.4, 0, 0, 20)
KeybindLabel.Position = UDim2.new(0.05, 0, 0.78, 0)
KeybindLabel.BackgroundTransparency = 1
KeybindLabel.Text = "KEYBIND :"
KeybindLabel.TextColor3 = Color3.fromRGB(170, 170, 170)
KeybindLabel.TextScaled = true
KeybindLabel.Font = Enum.Font.GothamBold
KeybindLabel.Parent = Frame

-- Keybind TextBox
local KeybindBox = Instance.new("TextBox")
KeybindBox.Size = UDim2.new(0.25, 0, 0, 22)
KeybindBox.Position = UDim2.new(0.5, 0, 0.78, 0)
KeybindBox.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
KeybindBox.TextColor3 = Color3.fromRGB(200, 200, 200)
KeybindBox.TextScaled = true
KeybindBox.Font = Enum.Font.GothamBold
KeybindBox.Text = "T"
KeybindBox.ClearTextOnFocus = false
KeybindBox.Parent = Frame
Instance.new("UICorner", KeybindBox).CornerRadius = UDim.new(0, 8)

-- REMOTE MAPPER (TON CODE)
local RemoteIndex = {}
local RemoteObjects = {}

local children = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("Net")
    :GetChildren()

for i, obj in ipairs(children) do
    if obj:IsA("RemoteEvent") then
        local nextIndex = i + 1
        local nextObj = children[nextIndex]
        
        if nextObj then
            RemoteIndex[obj.Name] = nextIndex
            RemoteObjects[nextIndex] = nextObj
        end
    end
end

local function fireRemoteI(index, ...)
    local remote = RemoteObjects[index]
    if remote then
        remote:FireServer(...)
        return true
    else
        return false
    end
end

local function fireRemote(name, ...)
    local index = RemoteIndex[name]
    if index then
        return fireRemoteI(index, ...)
    else
        return false
    end
end

-- TOGGLE
local allowed = false
local debounce = false

local function updateButton()
    if allowed then
        Button.Text = "ðŸ”“ CALNA ALLOW FRIENDS : ON"
    else
        Button.Text = "ðŸ”’ CALNA ALLOW FRIENDS : OFF"
    end
end

updateButton()

local function toggle()
    if debounce then return end
    debounce = true

    Button.Text = "WAIT 1 SECOND"
    task.wait(1)

    local success = fireRemote("RE/PlotService/ToggleFriends")

    if success then
        allowed = not allowed
        updateButton()
    else
        Button.Text = "REMOTE NOT FOUND"
        task.wait(1)
        updateButton()
    end

    debounce = false
end

Button.MouseButton1Click:Connect(toggle)

-- KEYBIND
local keybind = Enum.KeyCode.T

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == keybind then
        toggle()
    end
end)

KeybindBox.FocusLost:Connect(function(enterPressed)
    local txt = KeybindBox.Text:upper()
    local key = Enum.KeyCode[txt]
    if key then
        keybind = key
        KeybindBox.Text = txt
    else
        KeybindBox.Text = "T"
        keybind = Enum.KeyCode.T
    end
end)
